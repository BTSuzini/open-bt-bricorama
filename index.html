<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Open BT Bricorama â€” Infos & Inscriptions</title>
  <link rel="stylesheet" href="assets/css/main.css?v=20260219" />
</head>
<body>

<header class="topbar">
  <div class="container">
    <div class="topbar-row">
      <div class="brand-logo">
        <img src="assets/img/logo-suzini.png" alt="Logo Suzini">
      </div>

      <h1 class="brand-title">Open BT Bricorama</h1>

      <div class="brand-logo">
        <img src="assets/img/logo-openbt.png" alt="Logo Open BT Bricorama">
      </div>
    </div>

    <nav class="nav">
      <a href="index.html" aria-current="page">Accueil</a>
      <a href="dh/programmation.html">DM</a>
      <a href="dd/programmation.html">DD</a>

      <a href="pages/infos.html">Infos</a>
      <a href="pages/reglement.html">RÃ¨glement</a>
      <a href="pages/repas.html">Repas</a>
      <a href="pages/contact.html">Contact</a>
    </nav>
  </div>
</header>

<main class="container">

  <section class="card">
    <h2>Les tournois</h2>

    <div class="grid">
      <a class="btn" href="dd/programmation.html">ğŸ‘©â€ğŸ¦± Tournoi Double Dames</a>
      <a class="btn" href="dh/programmation.html">ğŸ‘¨â€ğŸ¦± Tournoi Double Messieurs</a>
    </div>

    <p class="muted" style="margin-top:10px;">
      Mini-site dÃ©diÃ© au tournoi <b>Open BT Bricorama</b> (indÃ©pendant du challenge).
    </p>
  </section>

  <section class="card">
    <h2>AccÃ¨s rapide</h2>
    <div class="grid">
      <a class="btn" href="pages/infos.html">â„¹ï¸ Infos</a>
      <a class="btn" href="pages/reglement.html">ğŸ“˜ RÃ¨glement</a>
      <a class="btn" href="pages/repas.html">ğŸ½ï¸ Repas</a>
      <a class="btn" href="pages/contact.html">ğŸ“© Contact</a>
    </div>
  </section>

  <section class="card">
    <h2>ğŸ” AccÃ¨s organisateurs</h2>

    <div class="grid">
      <a class="btn" href="#" id="btnAdmin">ğŸ› ï¸ Mode Admin</a>
      <a class="btn" href="#" id="btnLogout">ğŸšª DÃ©connexion</a>
    </div>

    <p class="muted">AccÃ¨s sÃ©curisÃ© (email / mot de passe).</p>
    <p class="muted" id="authHint" style="margin-top:8px;"></p>
  </section>

</main>

<footer class="footer">
  <div class="container">
    <span>Â© TCS â€” Open BT Bricorama</span>
  </div>
</footer>

<script type="module">
  import { auth } from "./assets/js/firebase.js";
  import { loginAndRedirect, logout, getRoleByEmail } from "./assets/js/session.js";
  import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";

  const hint = document.getElementById("authHint");

  async function guardAdminAndGo(url){
    // login si besoin
    if(!auth.currentUser){
      await loginAndRedirect();
    }
    const u = auth.currentUser;
    if(!u){
      alert("Connexion annulÃ©e.");
      return;
    }

    // check rÃ´le
    const role = await getRoleByEmail(u.email);
    if(role !== "admin"){
      alert("AccÃ¨s refusÃ© : rÃ´le requis = admin");
      return;
    }

    window.location.href = url;
  }

  document.getElementById("btnAdmin").onclick = async (e)=>{
    e.preventDefault();
    await guardAdminAndGo("admin/index.html");
  };

  document.getElementById("btnLogout").onclick = async (e)=>{
    e.preventDefault();
    await logout();
    alert("DÃ©connectÃ© âœ…");
  };

  onAuthStateChanged(auth, (user)=>{
    hint.textContent = user ? ("ConnectÃ© : " + user.email) : "Non connectÃ©.";
  });
</script>

</body>
</html>
